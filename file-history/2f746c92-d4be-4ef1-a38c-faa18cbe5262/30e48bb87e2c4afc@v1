"""
Test desktop version crawler
"""
import asyncio
import sys
import os

# Add the app directory to the path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), "."))

from app.services.naver_cafe_crawler import NaverCafeCrawler


async def main():
    print("=== Testing Desktop Crawler ===\n")

    crawler = NaverCafeCrawler()

    # Test crawling menu 1
    print("Crawling menu 1 (first 5 posts only for quick test)...\n")
    results = await crawler.crawl_menu(1)

    print(f"\n=== Results ===")
    print(f"Total posts crawled: {len(results)}\n")

    # Show first 3 results
    for i, post in enumerate(results[:3], 1):
        print(f"\n--- Post {i} ---")
        print(f"Title: {post['title']}")
        print(f"Author: {post['author']}")
        print(f"URL: {post['url']}")
        print(f"External ID: {post['external_id']}")
        print(f"Content length: {len(post['content'])} chars")
        print(f"Content preview: {post['content'][:100]}..." if post['content'] else "Content preview: (empty)")
        print(f"Comments: {len(post['comments'])} comments")
        if post['comments']:
            print(f"First comment: {post['comments'][0]['author']}: {post['comments'][0]['content'][:50]}...")
        print(f"Created at: {post['created_at']}")

    print("\n=== Test Complete! ===")

    # Check success rate
    posts_with_content = sum(1 for p in results if p['content'])
    success_rate = (posts_with_content / len(results) * 100) if results else 0
    print(f"\nSuccess rate: {posts_with_content}/{len(results)} posts ({success_rate:.1f}%) have content")


if __name__ == "__main__":
    asyncio.run(main())
