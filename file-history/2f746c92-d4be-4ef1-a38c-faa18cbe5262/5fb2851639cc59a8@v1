"""
Test DB saving with dummy data
"""
import asyncio
import sys
import os
from datetime import datetime

# Add the app directory to the path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), "."))

from app.services.post_service import save_posts, get_recent_posts


async def main():
    print("=== Testing DB Save with Dummy Data ===\n")

    # Create dummy data
    dummy_posts = [
        {
            "source": "naver_cafe",
            "external_id": "naver_cafe_28866679_test_001",
            "title": "테스트 게시글 1",
            "url": "https://cafe.naver.com/test/1",
            "author": "테스트유저1",
            "content": "이것은 테스트 게시글 내용입니다.",
            "comments": [
                {"author": "댓글작성자1", "content": "좋은 글이네요", "is_reply": False},
                {"author": "댓글작성자2", "content": "감사합니다", "is_reply": False},
            ],
            "created_at": datetime.utcnow(),
            "collected_at": datetime.utcnow(),
        },
        {
            "source": "naver_cafe",
            "external_id": "naver_cafe_28866679_test_002",
            "title": "테스트 게시글 2",
            "url": "https://cafe.naver.com/test/2",
            "author": "테스트유저2",
            "content": "두 번째 테스트 게시글입니다.",
            "comments": [],
            "created_at": datetime.utcnow(),
            "collected_at": datetime.utcnow(),
        },
    ]

    # Save to DB
    print("Saving dummy posts to database...")
    save_result = await save_posts(dummy_posts)
    print(f"Save result: {save_result}\n")

    # Retrieve from DB
    print("Retrieving from database...")
    posts = await get_recent_posts(limit=10)
    print(f"Retrieved {len(posts)} posts from DB\n")

    for i, post in enumerate(posts, 1):
        print(f"{i}. {post.title}")
        print(f"   External ID: {post.external_id}")
        print(f"   Author: {post.author}")
        print(f"   Content: {post.content[:50]}...")
        print(f"   Comments: {len(post.comments)} comments")
        print(f"   Collected at: {post.collected_at}\n")

    print("=== DB Test Complete! ===")


if __name__ == "__main__":
    asyncio.run(main())
